<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ZippUp — On‑Demand Services</title>
  <meta name="theme-color" content="#2563EB"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🚀</text></svg>">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🚀</text></svg>">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="mobile-web-app-capable" content="yes">

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    :root { --primary:#2563EB; --primary-600:#1D4ED8; --bg:#F9FAFB; --card:#FFFFFF; --text:#111827; --muted:#6B7280; --danger:#DC2626; --success:#10B981; --info:#06B6D4; --warning:#F59E0B; --border:#E5E7EB; --radius:14px; --shadow:0 8px 24px rgba(17,24,39,.08) }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    .hidden{display:none!important}

    /* Splash */
    .splash-screen{position:fixed;inset:0;background:linear-gradient(135deg,var(--primary),#1E40AF);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;transition:opacity .5s}
    .splash-logo{font-size:4rem;margin-bottom:10px}
    .splash-title{color:#fff;font-size:2rem;font-weight:800}
    .splash-subtitle{color:rgba(255,255,255,.85);margin-top:6px}

    /* Auth */
    .auth-screen{position:fixed;inset:0;background:var(--bg);display:none;align-items:center;justify-content:center;padding:20px;z-index:1000}
    .auth-container{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:28px;width:100%;max-width:420px}
    .auth-title{font-size:1.5rem;font-weight:700;margin-bottom:6px;text-align:center}
    .auth-subtitle{text-align:center;color:var(--muted);margin-bottom:16px}
    .demo-info{background:#F3F4F6;border:1px dashed var(--border);border-radius:12px;padding:12px;margin-bottom:16px;font-size:.9rem}
    .input{width:100%;padding:12px 14px;border:2px solid var(--border);border-radius:12px;font-size:1rem;background:#fff}
    .input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.1)}
    .input.error{border-color:var(--danger)}
    .error-message{color:var(--danger);font-size:.85rem;margin-top:6px}
    .btn{width:100%;padding:12px 16px;border:0;border-radius:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px}
    .btn-primary{background:var(--primary);color:#fff}
    .btn-primary:hover{background:var(--primary-600)}
    .btn.loading::after{content:'';width:16px;height:16px;border:2px solid transparent;border-top:2px solid currentColor;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* App */
    #app{display:none;min-height:100vh;padding-bottom:80px}
    .header{background:#fff;border-bottom:1px solid var(--border);padding:12px 16px;position:sticky;top:0;z-index:100}
    .header-content{display:flex;align-items:center;justify-content:space-between}
    .user-info{display:flex;gap:12px;align-items:center}
    .user-avatar{width:40px;height:40px;border-radius:50%;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800}
    .user-location{font-size:.85rem;color:var(--muted);cursor:pointer}
    .profile-section{position:relative}
    .profile-btn{border:0;background:transparent;padding:8px;border-radius:10px;cursor:pointer}
    .profile-btn:hover{background:#F3F4F6}
    .dropdown-menu{position:absolute;top:100%;right:0;background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);min-width:200px;opacity:0;visibility:hidden;transform:translateY(-8px);transition:.15s}
    .dropdown-menu.active{opacity:1;visibility:visible;transform:translateY(0)}
    .dropdown-item{display:flex;gap:8px;align-items:center;padding:12px 14px;border-bottom:1px solid #F3F4F6;cursor:pointer}
    .dropdown-item:last-child{border-bottom:0}
    .dropdown-item:hover{background:#F9FAFB}
    .page{display:none;min-height:calc(100vh - 160px)}
    .page.active{display:block}
    .page-header{display:flex;align-items:center;gap:12px;border-bottom:1px solid #F3F4F6;padding:14px 16px;background:#fff}
    .back-btn{border:0;background:transparent;padding:8px;border-radius:10px;cursor:pointer}
    .page-title{font-size:1.25rem;font-weight:700}
    .page-content{padding:16px}

    .search-section{padding:16px;background:#fff}
    .search-container{max-width:680px;margin:0 auto}
    .search-box{display:flex;gap:8px;background:#fff;border:2px solid var(--border);border-radius:14px;padding:6px 8px}
    .search-input{flex:1;border:0;outline:0;padding:10px;font-size:1rem;background:transparent}
    .voice-btn,.search-btn{width:42px;height:42px;border-radius:10px;border:0;background:var(--primary);color:#fff;cursor:pointer}
    .search-suggestions{position:absolute;left:0;right:0;background:#fff;border:1px solid var(--border);border-top:none;border-radius:0 0 14px 14px;max-height:320px;overflow:auto;opacity:0;visibility:hidden;transform:translateY(-6px);transition:.15s;z-index:50}
    .search-suggestions.active{opacity:1;visibility:visible;transform:translateY(0)}
    .suggestion-item{display:flex;gap:10px;padding:12px 14px;border-bottom:1px solid #F3F4F6;cursor:pointer}
    .suggestion-item:last-child{border-bottom:none}

    .services-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px;max-width:1200px;margin:0 auto}
    .service-card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:18px;cursor:pointer;transition:transform .1s}
    .service-card:hover{transform:translateY(-2px);box-shadow:var(--shadow)}
    .service-icon{font-size:2rem;margin-bottom:8px}
    .service-name{font-weight:800;margin-bottom:6px}
    .service-description{color:var(--muted);font-size:.95rem;margin-bottom:6px}
    .service-examples{color:#9CA3AF;font-size:.8rem;margin-bottom:10px}
    .service-price{font-weight:700;color:var(--primary)}

    .provider-card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:18px;margin-bottom:14px;cursor:pointer;transition:.1s}
    .provider-card:hover{transform:translateY(-2px);box-shadow:var(--shadow)}
    .provider-header{display:flex;gap:12px;align-items:center;margin-bottom:10px}
    .provider-avatar{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#EEF2FF}
    .provider-rating{color:#F59E0B;font-weight:700}
    .provider-details{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:8px}
    .provider-price{margin-top:10px;background:var(--primary);color:#fff;padding:8px 12px;border-radius:12px;text-align:center;font-weight:700}

    .bottom-nav{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--border);display:flex;justify-content:space-around;padding:8px 0;z-index:100}
    .nav-item{display:flex;flex-direction:column;align-items:center;gap:4px;padding:8px 10px;border-radius:10px;cursor:pointer;min-width:56px}
    .nav-item.active{color:var(--primary);background:#EFF6FF}
    .nav-label{font-size:.75rem;font-weight:600}

    .install-prompt{position:fixed;left:20px;right:20px;bottom:100px;background:#fff;border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:var(--shadow);opacity:0;visibility:hidden;transform:translateY(12px);transition:.2s;z-index:120}
    .install-prompt.show{opacity:1;visibility:visible;transform:translateY(0)}
    .install-actions{display:flex;gap:8px;margin-top:8px}
    .install-actions button{flex:1;padding:10px;border-radius:12px;border:1px solid var(--border);cursor:pointer}
    .install-actions .btn-primary{background:var(--primary);border-color:var(--primary);color:#fff}

    .notification{position:fixed;top:20px;right:20px;background:#fff;color:var(--text);border-left:4px solid var(--info);box-shadow:var(--shadow);padding:12px 16px;border-radius:12px;max-width:320px;opacity:0;transform:translateX(100%);transition:.2s;z-index:9999}
    .notification.show{opacity:1;transform:translateX(0)}
    .notification.success{border-left-color:var(--success)}
    .notification.error{border-left-color:var(--danger)}
    .notification.warning{border-left-color:var(--warning)}

    .emergency-btn{position:fixed;right:18px;bottom:90px;width:60px;height:60px;border-radius:50%;border:0;background:var(--danger);color:#fff;font-size:1.4rem;z-index:120;box-shadow:var(--shadow);cursor:pointer}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:20px;z-index:1000}
    .modal-content{background:#fff;border-radius:16px;max-width:420px;width:100%;max-height:80vh;overflow:auto;padding:20px}
    .modal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .close-btn{background:transparent;border:0;font-size:1.4rem;cursor:pointer;color:var(--muted)}
    @media(max-width:720px){.services-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <!-- Splash -->
  <div id="splash-screen" class="splash-screen">
    <div class="splash-logo">🚀</div>
    <div class="splash-title">ZippUp</div>
    <div class="splash-subtitle">Your Complete Service Platform</div>
  </div>

  <!-- Install Prompt -->
  <div id="install-prompt" class="install-prompt">
    <div style="display:flex;gap:10px;align-items:center;margin-bottom:8px">
      <div style="font-size:2rem">📱</div>
      <div>
        <div style="font-weight:700">Install ZippUp</div>
        <div style="color:var(--muted);font-size:.9rem">Add to home screen for the best experience</div>
      </div>
    </div>
    <div class="install-actions">
      <button id="dismiss-install">Not now</button>
      <button id="install-btn" class="btn-primary">Install</button>
    </div>
  </div>

  <!-- Auth -->
  <div id="auth-screen" class="auth-screen">
    <div class="auth-container">
      <div style="text-align:center;margin-bottom:12px;font-size:2rem">🚀</div>
      <div class="auth-title">Welcome to ZippUp</div>
      <div class="auth-subtitle">Sign in to continue</div>

      <div class="demo-info">
        <strong>Demo:</strong> demo@zippup.com / password123
      </div>

      <div id="login-form">
        <div class="input-group" style="margin-bottom:12px">
          <input id="login-email" class="input" placeholder="Email or Phone" autocomplete="username">
          <div id="login-email-error" class="error-message hidden"></div>
        </div>
        <div class="input-group" style="margin-bottom:12px">
          <input id="login-password" class="input" placeholder="Password" type="password" autocomplete="current-password">
          <div id="login-password-error" class="error-message hidden"></div>
        </div>
        <button id="login-btn" class="btn btn-primary">Sign In</button>
        <button id="demo-login-btn" class="btn" style="margin-top:10px;background:var(--success);color:#fff">Quick Demo Login</button>
        <div style="text-align:center;margin-top:12px;color:var(--muted)">
          Don't have an account?
          <a id="show-register" href="#" style="color:var(--primary);font-weight:700;text-decoration:none">Sign up</a>
        </div>
      </div>

      <div id="register-form" class="hidden">
        <div class="input-group" style="margin-bottom:12px">
          <input id="register-name" class="input" placeholder="Full Name" autocomplete="name">
          <div id="register-name-error" class="error-message hidden"></div>
        </div>
        <div class="input-group" style="margin-bottom:12px">
          <input id="register-email" class="input" placeholder="Email Address" type="email" autocomplete="email">
          <div id="register-email-error" class="error-message hidden"></div>
        </div>
        <div class="input-group" style="margin-bottom:12px">
          <input id="register-phone" class="input" placeholder="Phone Number" autocomplete="tel">
          <div id="register-phone-error" class="error-message hidden"></div>
        </div>
        <div class="input-group" style="margin-bottom:12px">
          <input id="register-password" class="input" placeholder="Password (min 6 chars)" type="password" autocomplete="new-password">
          <div id="register-password-error" class="error-message hidden"></div>
        </div>
        <button id="register-btn" class="btn btn-primary">Create Account</button>
        <div style="text-align:center;margin-top:12px;color:var(--muted)">
          Already have an account?
          <a id="show-login" href="#" style="color:var(--primary);font-weight:700;text-decoration:none">Sign in</a>
        </div>
      </div>
    </div>
  </div>

  <!-- App -->
  <div id="app">
    <header class="header">
      <div class="header-content">
        <div class="user-info">
          <div class="user-avatar" id="user-avatar">U</div>
          <div>
            <div id="user-name" style="font-weight:800">Demo User</div>
            <div id="user-location" class="user-location">📍 Loading location...</div>
          </div>
        </div>
        <div class="profile-section">
          <button id="profile-btn" class="profile-btn">⚙️</button>
          <div id="dropdown-menu" class="dropdown-menu">
            <div id="wallet-nav" class="dropdown-item">💰 <span>Wallet</span></div>
            <div id="profile-nav" class="dropdown-item">👤 <span>Profile</span></div>
            <div id="marketplace-nav" class="dropdown-item">🛍️ <span>Marketplace</span></div>
            <div id="provider-registration-nav" class="dropdown-item">🔐 <span>Become Provider</span></div>
            <div id="logout-btn" class="dropdown-item">🚪 <span>Logout</span></div>
          </div>
        </div>
      </div>
    </header>

    <!-- Search -->
    <div class="search-section">
      <div class="search-container">
        <div style="position:relative">
          <div class="search-box">
            <input id="search-input" class="search-input" placeholder="Search services, food, transport...">
            <button id="voice-btn" class="voice-btn">🎤</button>
            <button id="search-btn" class="search-btn">🔍</button>
          </div>
          <div id="search-suggestions" class="search-suggestions"></div>
        </div>
      </div>
    </div>

    <!-- Emergency -->
    <button id="emergency-btn" class="emergency-btn" title="Emergency">🚨</button>

    <!-- Home -->
    <div id="home-page" class="page active">
      <div class="page-content">
        <h3 style="font-size:1.2rem;font-weight:800;margin-bottom:10px">Quick Actions</h3>
        <div class="services-grid" style="grid-template-columns:repeat(4,1fr)">
          <div class="service-card quick-action" data-action="ride"><div class="service-icon">🚗</div><div class="service-name">Book Ride</div></div>
          <div class="service-card quick-action" data-action="food"><div class="service-icon">🍔</div><div class="service-name">Order Food</div></div>
          <div class="service-card quick-action" data-action="digital"><div class="service-icon">📱</div><div class="service-name">Buy Airtime</div></div>
          <div class="service-card quick-action" data-action="marketplace"><div class="service-icon">🛍️</div><div class="service-name">Shop</div></div>
        </div>

        <h3 style="font-size:1.2rem;font-weight:800;margin:16px 0 10px">All Services</h3>
        <div id="services" class="services-grid"></div>
      </div>
    </div>

    <!-- Services -->
    <div id="services-page" class="page">
      <div class="page-header">
        <button id="services-back" class="back-btn">←</button>
        <div class="page-title">All Services</div>
      </div>
      <div class="page-content"><div id="all-services" class="services-grid"></div></div>
    </div>

    <!-- Providers -->
    <div id="providers-page" class="page">
      <div class="page-header">
        <button id="providers-back" class="back-btn">←</button>
        <div id="providers-title" class="page-title">Service Providers</div>
      </div>
      <div class="page-content"><div id="providers-list"></div></div>
    </div>

    <!-- Food categories -->
    <div id="food-categories-page" class="page">
      <div class="page-header">
        <button id="food-categories-back" class="back-btn">←</button>
        <div class="page-title">Food & Delivery</div>
      </div>
      <div class="page-content">
        <div class="services-grid">
          <div class="service-card" data-category="fastfood"><div class="service-icon">🍔</div><div class="service-name">Fast Food</div><div class="service-description">Quick meals and snacks</div><div class="service-price">From <span class="currency">$5</span></div></div>
          <div class="service-card" data-category="grocery"><div class="service-icon">🛒</div><div class="service-name">Grocery Shopping</div><div class="service-description">Fresh groceries delivered</div><div class="service-price">From <span class="currency">$10</span></div></div>
        </div>
      </div>
    </div>

    <!-- Wallet -->
    <div id="wallet-page" class="page">
      <div class="page-header"><button id="wallet-back" class="back-btn">←</button><div class="page-title">My Wallet</div></div>
      <div class="page-content">
        <div class="provider-card" style="text-align:center">
          <div style="font-weight:800;color:var(--muted);margin-bottom:6px">Current Balance</div>
          <div style="font-size:2rem;font-weight:800;color:var(--primary)"><span class="currency">$245.80</span></div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:16px">
            <button id="add-money" class="btn btn-primary">💰 Add Money</button>
            <button id="send-money" class="btn" style="background:var(--success);color:#fff">📤 Send</button>
          </div>
        </div>
        <h3 style="margin:12px 0 8px">Recent Transactions</h3>
        <div id="wallet-transactions">
          <div class="provider-card"><div style="display:flex;justify-content:space-between"><div><div style="font-weight:700">Food Delivery</div><div style="color:var(--muted);font-size:.9rem">Pizza Palace - Order #1234</div></div><div style="color:var(--danger);font-weight:800">-<span class="currency">$18.50</span></div></div></div>
          <div class="provider-card"><div style="display:flex;justify-content:space-between"><div><div style="font-weight:700">Wallet Top-up</div><div style="color:var(--muted);font-size:.9rem">Card ending in 4567</div></div><div style="color:var(--success);font-weight:800">+<span class="currency">$100.00</span></div></div></div>
        </div>
      </div>
    </div>

    <!-- Profile -->
    <div id="profile-page" class="page">
      <div class="page-header"><button id="profile-back" class="back-btn">←</button><div class="page-title">My Profile</div></div>
      <div class="page-content">
        <div id="provider-registration-card" class="provider-card" style="border:2px dashed var(--border);text-align:center;cursor:pointer">
          <div style="font-size:2.4rem;margin-bottom:6px;color:var(--primary)">🔐</div>
          <div style="font-weight:800">Become a Verified Provider</div>
          <div style="color:var(--muted);font-size:.95rem">Join our network and start earning by offering your services</div>
        </div>

        <div id="provider-status" class="hidden">
          <div style="display:flex;align-items:center;justify-content:space-between;border:1px solid var(--border);border-radius:12px;padding:12px;background:#F9FAFB;margin-bottom:10px">
            <div>
              <div style="font-weight:800">Provider Status</div>
              <div style="color:var(--muted);font-size:.9rem">Toggle your availability to receive bookings</div>
            </div>
            <div id="availability-toggle" class="toggle-switch" style="position:relative;width:46px;height:26px;background:#D1D5DB;border-radius:13px;cursor:pointer">
              <div class="toggle-slider" style="position:absolute;top:3px;left:3px;width:20px;height:20px;border-radius:50%;background:#fff;transition:transform .15s"></div>
            </div>
          </div>
          <div class="provider-card">
            <div class="provider-status available" style="display:flex;gap:8px;align-items:center;color:var(--success)">
              <div class="status-indicator" style="width:8px;height:8px;border-radius:50%;background:currentColor"></div>
              <span>Available for bookings</span>
            </div>
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px">
              <div style="text-align:center"><div style="font-weight:800;color:var(--primary)">47</div><div style="color:var(--muted);font-size:.85rem">Completed</div></div>
              <div style="text-align:center"><div style="font-weight:800;color:var(--primary)">4.8</div><div style="color:var(--muted);font-size:.85rem">Rating</div></div>
              <div style="text-align:center"><div style="font-weight:800;color:var(--primary)"><span class="currency">$1,240</span></div><div style="color:var(--muted);font-size:.85rem">Earned</div></div>
            </div>
          </div>
        </div>

        <div class="provider-card">
          <div style="font-weight:800;margin-bottom:10px">Personal Information</div>
          <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px">
            <div class="user-avatar" style="width:60px;height:60px;font-size:1.4rem">U</div>
            <div>
              <div id="profile-name" style="font-weight:800">Demo User</div>
              <div id="profile-email" style="color:var(--muted)">demo@zippup.com</div>
              <div id="profile-phone" style="color:var(--muted)">+1234567890</div>
            </div>
          </div>
          <button id="edit-profile" class="btn btn-primary">✏️ Edit Profile</button>
        </div>

        <div class="provider-card">
          <div style="font-weight:800;margin-bottom:10px">Account Settings</div>
          <div style="display:grid;gap:10px">
            <button id="payment-methods" class="dropdown-item" style="border-radius:12px">💳 Payment Methods</button>
            <button id="notifications-settings" class="dropdown-item" style="border-radius:12px">🔔 Notifications</button>
            <button id="help-support" class="dropdown-item" style="border-radius:12px">❓ Help & Support</button>
            <button id="settings" class="dropdown-item" style="border-radius:12px">⚙️ App Settings</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bookings -->
    <div id="bookings-page" class="page">
      <div class="page-header"><button id="bookings-back" class="back-btn">←</button><div class="page-title">My Bookings</div></div>
      <div class="page-content"><div id="bookings-list"></div></div>
    </div>

    <!-- Chat -->
    <div id="chat-page" class="page">
      <div class="page-header"><button id="chat-back" class="back-btn">←</button><div class="page-title">Messages</div></div>
      <div class="page-content">
        <div style="text-align:center;padding:60px 20px">
          <div style="font-size:4rem;margin-bottom:16px">💬</div>
          <div style="font-weight:800">No messages yet</div>
          <div style="color:var(--muted);margin-top:6px">Start a booking to chat with providers</div>
        </div>
      </div>
    </div>

    <!-- Food items -->
    <div id="food-items-page" class="page">
      <div class="page-header"><button id="food-items-back" class="back-btn">←</button><div id="food-items-title" class="page-title">Food Items</div></div>
      <div class="page-content">
        <div style="margin-bottom:12px"><input id="food-search-input" class="input" placeholder="Search for specific items..."></div>
        <div id="food-items-grid" class="services-grid"></div>
      </div>
    </div>

    <!-- Grocery -->
    <div id="grocery-page" class="page">
      <div class="page-header"><button id="grocery-back" class="back-btn">←</button><div class="page-title">Grocery Stores</div></div>
      <div class="page-content">
        <div style="margin-bottom:12px"><input id="grocery-search-input" class="input" placeholder="Search grocery stores or products..."></div>
        <div id="grocery-stores"></div>
      </div>
    </div>

    <!-- Transport -->
    <div id="transport-categories-page" class="page">
      <div class="page-header"><button id="transport-categories-back" class="back-btn">←</button><div class="page-title">Transport Services</div></div>
      <div class="page-content">
        <div class="services-grid">
          <div class="service-card" data-transport="ride"><div class="service-icon">🚗</div><div class="service-name">Ride Services</div><div class="service-description">Personal transportation</div><div class="service-price">From <span class="currency">$5</span></div></div>
          <div class="service-card" data-transport="moving"><div class="service-icon">🚛</div><div class="service-name">Moving & Delivery</div><div class="service-description">Transport goods and items</div><div class="service-price">From <span class="currency">$25</span></div></div>
        </div>
      </div>
    </div>

    <!-- Digital -->
    <div id="digital-services-page" class="page">
      <div class="page-header"><button id="digital-services-back" class="back-btn">←</button><div class="page-title">Digital Services</div></div>
      <div class="page-content">
        <div class="services-grid">
          <div class="service-card" data-digital="airtime"><div class="service-icon">📞</div><div class="service-name">Buy Airtime</div></div>
          <div class="service-card" data-digital="data"><div class="service-icon">📶</div><div class="service-name">Data Bundles</div></div>
          <div class="service-card" data-digital="bills"><div class="service-icon">💡</div><div class="service-name">Pay Bills</div></div>
          <div class="service-card" data-digital="vouchers"><div class="service-icon">🎁</div><div class="service-name">Gift Vouchers</div></div>
          <div class="service-card" data-digital="gaming"><div class="service-icon">🎮</div><div class="service-name">Gaming Credits</div></div>
          <div class="service-card" data-digital="streaming"><div class="service-icon">📺</div><div class="service-name">Streaming</div></div>
        </div>
      </div>
    </div>

    <!-- Marketplace -->
    <div id="marketplace-page" class="page">
      <div class="page-header"><button id="marketplace-back" class="back-btn">←</button><div class="page-title">Marketplace</div></div>
      <div class="page-content">
        <div class="services-grid">
          <div class="service-card" data-marketplace="electronics"><div class="service-icon">📱</div><div class="service-name">Electronics</div></div>
          <div class="service-card" data-marketplace="fashion"><div class="service-icon">👕</div><div class="service-name">Fashion</div></div>
          <div class="service-card" data-marketplace="home"><div class="service-icon">🏠</div><div class="service-name">Home & Garden</div></div>
          <div class="service-card" data-marketplace="sports"><div class="service-icon">⚽</div><div class="service-name">Sports</div></div>
        </div>
      </div>
    </div>

    <!-- Bottom nav -->
    <nav class="bottom-nav">
      <div class="nav-item active" data-page="home"><div>🏠</div><div class="nav-label">Home</div></div>
      <div class="nav-item" data-page="services"><div>🔧</div><div class="nav-label">Services</div></div>
      <div class="nav-item" data-page="marketplace"><div>🛍️</div><div class="nav-label">Shop</div></div>
      <div class="nav-item" data-page="bookings"><div>📋</div><div class="nav-label">Bookings</div></div>
      <div class="nav-item" data-page="chat"><div>💬</div><div class="nav-label">Chat</div></div>
    </nav>
  </div>

  <!-- Emergency Modal -->
  <div id="emergency-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="page-title">🚨 Emergency Services</div>
        <button onclick="closeEmergencyModal()" class="close-btn">×</button>
      </div>
      <div style="display:grid;gap:12px">
        <div class="provider-card emergency-service" data-emergency="ambulance"><div class="provider-header"><div style="font-size:2rem">🚑</div><div><div style="font-weight:800">Ambulance</div><div style="color:var(--muted)">Medical emergency response • ETA 8–12m</div></div></div></div>
        <div class="provider-card emergency-service" data-emergency="fire"><div class="provider-header"><div style="font-size:2rem">🚒</div><div><div style="font-weight:800">Fire Department</div><div style="color:var(--muted)">Fire and rescue • ETA 5–8m</div></div></div></div>
        <div class="provider-card emergency-service" data-emergency="towing"><div class="provider-header"><div style="font-size:2rem">🚛</div><div><div style="font-weight:800">Towing Service</div><div style="color:var(--muted)">Vehicle towing • ETA 15–25m</div></div></div></div>
        <div class="provider-card emergency-service" data-emergency="roadside"><div class="provider-header"><div style="font-size:2rem">🔧</div><div><div style="font-weight:800">Roadside Assistance</div><div style="color:var(--muted)">Flat tire, battery, fuel • ETA 10–15m</div></div></div></div>
      </div>
    </div>
  </div>

  <script>
/* ====== State ====== */
let currentUser = null;
let isAuthenticated = false;
let supabaseClient = null;
let currentPage = 'home';
let currentService = null;
let currentLocation = null;
let bookings = [];
let deferredPrompt = null;
let userCurrency = '$';
let userCountry = 'US';
let isProvider = false;
let providerAvailable = true;

const mockUsers = [
  { email: 'demo@zippup.com', password: 'password123', name: 'Demo User', phone: '+1234567890', isProvider: false },
  { email: 'provider@zippup.com', password: 'provider123', name: 'Provider Demo', phone: '+1987654321', isProvider: true },
  { email: 'test@example.com', password: 'test123', name: 'Test User', phone: '+0987654321', isProvider: false }
];

const currencyMap = {
  'US': '$','CA': 'CAD$','GB': '£','EU': '€','JP': '¥','AU': 'AUD$',
  'NG': '₦','KE': 'KSh','ZA': 'R','GH': '₵','EG': 'E£',
  'IN': '₹','CN': '¥','KR': '₩','TH': '฿','VN': '₫',
  'MX': 'MX$','BR': 'R$','AR': 'AR$','CL': 'CL$','CO': 'COP$'
};

const services = [
  { id:1,name:'Transport',icon:'🚗',description:'Rides & moving services',examples:['Taxi','Bike rides','Moving trucks','Delivery','etc'],price:15,type:'transport',hasInstant:true,hasScheduled:true },
  { id:2,name:'Personal Care',icon:'💅',description:'Beauty & wellness',examples:['Hair styling','Massage','Manicure','Spa treatments','etc'],price:30,type:'service',hasInstant:false,hasScheduled:true },
  { id:3,name:'Tech Services',icon:'🔧',description:'Device repair & support',examples:['Phone repair','Computer fixing','TV repair','Software help','etc'],price:40,type:'service',hasInstant:true,hasScheduled:true },
  { id:4,name:'Construction',icon:'🏗️',description:'Building & repairs',examples:['Builders','Carpenters','Electricians','Plumbers','etc'],price:80,type:'service',hasInstant:false,hasScheduled:true },
  { id:5,name:'Home Services',icon:'🏠',description:'Household maintenance',examples:['House cleaning','Gardening','Maintenance','Painting','etc'],price:35,type:'service',hasInstant:true,hasScheduled:true },
  { id:6,name:'Emergency',icon:'🚨',description:'Urgent help services',examples:['Ambulance','Fire services','Roadside help','Towing','etc'],price:100,type:'emergency',hasInstant:true,hasScheduled:false },
  { id:7,name:'Food Delivery',icon:'🍔',description:'Restaurant & grocery',examples:['Restaurant delivery','Grocery shopping','Fast food','Catering','etc'],price:15,type:'food',hasInstant:true,hasScheduled:true },
  { id:8,name:'Digital Services',icon:'📱',description:'Airtime, data & bills',examples:['Buy airtime','Data bundles','Pay bills','Gift vouchers','etc'],price:5,type:'digital',hasInstant:true,hasScheduled:false },
  { id:9,name:'Others',icon:'🎯',description:'Events, tutoring & more',examples:['Event planning','Tutoring','Legal services','Photography','etc'],price:50,type:'others',hasInstant:false,hasScheduled:true }
];

const othersProviders = [
  { id:901,name:'EventPro Planners',avatar:'🎪',rating:4.9,events:125,experience:'5 years',price:'$200-1500',description:'Full-service event planning',distance:'1.2km' },
  { id:902,name:'Sarah Math Tutor',avatar:'📚',rating:4.8,students:89,experience:'3 years',price:'$25-40/hr',description:'Maths & science tutoring',distance:'0.8km' },
  { id:903,name:'Legal Aid Pro',avatar:'⚖️',rating:4.7,cases:67,experience:'8 years',price:'$100-300/hr',description:'Legal consultation',distance:'2.1km' },
  { id:904,name:'Focus Photography',avatar:'📸',rating:4.9,shoots:234,experience:'6 years',price:'$150-800',description:'Professional photography',distance:'1.5km' }
];

const searchData = [
  { title:'Pizza',category:'Food',icon:'🍕',action:()=>showFoodItems('pizza') },
  { title:'Taxi',category:'Transport',icon:'🚗',action:()=>showTransportCategory('ride') },
  { title:'Hair styling',category:'Personal Care',icon:'💇',action:()=>showProviders(services.find(s=>s.id===2)) },
  { title:'Phone repair',category:'Tech',icon:'📱',action:()=>showProviders(services.find(s=>s.id===3)) },
  { title:'House cleaning',category:'Home',icon:'🏠',action:()=>showProviders(services.find(s=>s.id===5)) },
  { title:'Buy airtime',category:'Digital',icon:'📞',action:()=>showDigitalService('airtime') },
  { title:'Event planning',category:'Others',icon:'🎪',action:()=>showOthersProviders() },
  { title:'Tutoring',category:'Others',icon:'📚',action:()=>showOthersProviders() },
  { title:'Legal services',category:'Others',icon:'⚖️',action:()=>showOthersProviders() },
  { title:'Photography',category:'Others',icon:'📸',action:()=>showOthersProviders() },
  { title:'Burger',category:'Food',icon:'🍔',action:()=>showFoodItems('burger') },
  { title:'Moving truck',category:'Transport',icon:'🚛',action:()=>showTransportCategory('moving') },
  { title:'Marketplace',category:'Shopping',icon:'🛍️',action:()=>navigateToPage('marketplace') },
  { title:'Emergency',category:'Emergency',icon:'🚨',action:()=>document.getElementById('emergency-modal').style.display='flex' }
];

const foodItems = {
  pizza:[{name:'Margherita Pizza',restaurant:'Pizza Palace',price:12.99,rating:'4.5',icon:'🍕',distance:'0.7km'}],
  burger:[{name:'Classic Beef Burger',restaurant:'Burger Haven',price:8.99,rating:'4.6',icon:'🍔',distance:'0.5km'}],
  meat:[{name:'Grilled Steak',restaurant:'Steakhouse Pro',price:24.99,rating:'4.9',icon:'🥩',distance:'2.1km'}],
  fries:[{name:'Classic Fries',restaurant:'Fry House',price:4.99,rating:'4.4',icon:'🍟',distance:'0.3km'}],
  chicken:[{name:'Fried Chicken',restaurant:'Crispy Chicken Co',price:11.99,rating:'4.7',icon:'🍗',distance:'1.0km'}],
  drinks:[{name:'Fresh Orange Juice',restaurant:'Juice Bar',price:3.99,rating:'4.5',icon:'🥤',distance:'0.4km'}]
};

const groceryStores = [
  { id:501,name:'Fresh Market',avatar:'🛒',rating:4.6,items:5000,experience:'5 years',delivery:userCurrency+'2.99 delivery',description:'Fresh fruits & household',distance:'0.8km' },
  { id:502,name:'SuperMart Express',avatar:'🏪',rating:4.8,items:8000,experience:'3 years',delivery:userCurrency+'2.99 delivery',description:'One‑stop shop',distance:'1.2km' },
  { id:503,name:'Organic Plus',avatar:'🥬',rating:4.9,items:2000,experience:'7 years',delivery:'Free over '+userCurrency+'50',description:'Premium organic',distance:'1.5km' }
];

const transportProviders = {
  ride:[
    { id:101,name:'John Driver',avatar:'🚗',rating:4.8,trips:1250,experience:'3 years',price:'15-25',description:'Clean car, great service',distance:'0.3km' },
    { id:102,name:'Sarah Taxi',avatar:'🚕',rating:4.9,trips:890,experience:'5 years',price:'18-30',description:'Reliable 24/7 taxi',distance:'0.7km' }
  ],
  moving:[
    { id:201,name:'Heavy Movers',avatar:'🚛',rating:4.8,jobs:450,experience:'6 years',price:'50-150',description:'Experienced team',distance:'1.5km' }
  ]
};

/* ====== Init ====== */
document.addEventListener('DOMContentLoaded', initApp);

async function initApp(){
  try{
    const supaUrl='https://xxrtlkyqjqdhkenpkwll.supabase.co';
    const supaAnon='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh4cnRsa3lxanFkaGtlbnBrd2xsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ1OTkyMTEsImV4cCI6MjA3MDE3NTIxMX0.LKBzuOIjjmgoYAjMPHtJ3KkYaNC3A42nh4CHy8aKUp4';
    supabaseClient = window.supabase.createClient(supaUrl, supaAnon);
    const { data:{ session } } = await supabaseClient.auth.getSession();
    if(session?.user){
      currentUser = {
        name: session.user.user_metadata?.full_name || 'User',
        email: session.user.email || '',
        phone: session.user.user_metadata?.phone || '',
        isProvider: false
      };
      isAuthenticated = true;
    }
  }catch(e){ console.warn('Supabase init issue', e); }

  const savedUser = localStorage.getItem('zippup_user');
  if(savedUser){
    try{ currentUser=JSON.parse(savedUser); isAuthenticated=true; isProvider=!!currentUser.isProvider; }catch{ localStorage.removeItem('zippup_user'); }
  }

  setTimeout(()=>{
    document.getElementById('splash-screen').style.opacity='0';
    setTimeout(()=>{
      document.getElementById('splash-screen').style.display='none';
      if(isAuthenticated){ showMainApp(); } else { showAuthScreen(); }
    },500);
  },1200);

  setupEventListeners();
  loadServices();
  loadBookings();
  initializeLocation();
  initializePWA();
  detectUserCurrency();
}

/* ====== PWA ====== */
function initializePWA(){
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('./sw.js').catch(()=>{});
  }
  window.addEventListener('beforeinstallprompt',(e)=>{
    e.preventDefault(); deferredPrompt=e;
    setTimeout(()=>{ if(deferredPrompt) showInstallPrompt(); }, 1500);
  });
  window.addEventListener('appinstalled',()=>{ hideInstallPrompt(); notify('🎉 ZippUp installed!', 'success'); deferredPrompt=null; });
}
function showInstallPrompt(){ const el=document.getElementById('install-prompt'); el.style.display='block'; requestAnimationFrame(()=>el.classList.add('show')); }
function hideInstallPrompt(){ const el=document.getElementById('install-prompt'); el.classList.remove('show'); setTimeout(()=>{ el.style.display='none'; },200); }

/* ====== Location ====== */
async function initializeLocation(){
  if(!('geolocation' in navigator)){ updateLocationUI('Location not supported'); return; }
  try{
    const pos = await new Promise((res,rej)=>navigator.geolocation.getCurrentPosition(res,rej,{enableHighAccuracy:true,timeout:10000,maximumAge:60000}));
    const { latitude, longitude } = pos.coords; currentLocation={latitude,longitude};
    const addr = await reverseGeocode(latitude, longitude);
    updateLocationUI(addr || 'Unknown location');
  }catch{ updateLocationUI('Location unavailable'); }
}
async function reverseGeocode(lat,lng){
  try{
    const r = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lng}&localityLanguage=en`);
    const j = await r.json();
    return `${j.locality || j.city}, ${j.countryName}`;
  }catch{ return null; }
}
function updateLocationUI(address){ document.getElementById('user-location').textContent = `📍 ${address}`; }

/* ====== Currency ====== */
async function detectUserCurrency(){
  try{
    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
    const region = tz.split('/')[0];
    if(currencyMap[region]) userCountry=region;
    else {
      const res = await fetch('https://ipapi.co/json/');
      const data = await res.json();
      userCountry = data.country_code || 'US';
    }
    userCurrency = currencyMap[userCountry] || '$';
    updateCurrencyDisplay();
  }catch{ userCurrency='$'; userCountry='US'; }
}
function updateCurrencyDisplay(){
  document.querySelectorAll('.currency').forEach(el=>{
    const amt = el.textContent.replace(/[^\d.-]/g,''); if(amt) el.textContent = userCurrency + amt;
  });
}

/* ====== Auth/UI ====== */
function showAuthScreen(){ document.getElementById('auth-screen').style.display='flex'; }
function showMainApp(){
  document.getElementById('app').style.display='block';
  if(currentUser){
    document.getElementById('user-name').textContent=currentUser.name || 'User';
    document.getElementById('profile-name').textContent=currentUser.name || 'User';
    document.getElementById('profile-email').textContent=currentUser.email || '';
    document.getElementById('profile-phone').textContent=currentUser.phone || 'Not provided';
    document.getElementById('user-avatar').textContent=(currentUser.name||'U')[0].toUpperCase();
    if(isProvider){
      document.getElementById('provider-registration-card').style.display='none';
      document.getElementById('provider-status').classList.remove('hidden');
      updateProviderStatus();
    }
  }
  notify('Welcome to ZippUp! 🚀','success');
}
function updateProviderStatus(){
  const t=document.getElementById('availability-toggle'); const s=document.querySelector('.provider-status');
  if(providerAvailable){ t.classList.add('active'); s.className='provider-status available'; s.innerHTML='<div class=\"status-indicator\" style=\"width:8px;height:8px;border-radius:50%;background:currentColor\"></div><span>Available for bookings</span>'; t.querySelector('.toggle-slider').style.transform='translateX(20px)'; t.style.background='#10B981'; }
  else { t.classList.remove('active'); s.className='provider-status unavailable'; s.innerHTML='<div class=\"status-indicator\" style=\"width:8px;height:8px;border-radius:50%;background:currentColor\"></div><span>Currently unavailable</span>'; t.querySelector('.toggle-slider').style.transform='translateX(0)'; t.style.background='#D1D5DB'; }
}

function setupEventListeners(){
  // Auth switches
  document.getElementById('show-register').addEventListener('click',e=>{e.preventDefault();document.getElementById('login-form').classList.add('hidden');document.getElementById('register-form').classList.remove('hidden');});
  document.getElementById('show-login').addEventListener('click',e=>{e.preventDefault();document.getElementById('register-form').classList.add('hidden');document.getElementById('login-form').classList.remove('hidden');});

  // Profile dropdown and outside close
  document.getElementById('profile-btn').addEventListener('click',e=>{e.stopPropagation();document.getElementById('dropdown-menu').classList.toggle('active');});
  document.addEventListener('click',()=>{document.getElementById('dropdown-menu').classList.remove('active');document.getElementById('search-suggestions').classList.remove('active');});

  // Registration
  document.getElementById('provider-registration-card').addEventListener('click',handleProviderRegistration);
  document.getElementById('provider-registration-nav').addEventListener('click',()=>{document.getElementById('dropdown-menu').classList.remove('active'); if(!isProvider) handleProviderRegistration(); else navigateToPage('profile');});

  // Availability
  document.getElementById('availability-toggle').addEventListener('click',()=>{providerAvailable=!providerAvailable;updateProviderStatus();notify(`You are now ${providerAvailable?'available':'unavailable'} for bookings`,'info');});

  // Dropdown nav
  document.getElementById('wallet-nav').addEventListener('click',()=>{document.getElementById('dropdown-menu').classList.remove('active');navigateToPage('wallet');});
  document.getElementById('profile-nav').addEventListener('click',()=>{document.getElementById('dropdown-menu').classList.remove('active');navigateToPage('profile');});
  document.getElementById('marketplace-nav').addEventListener('click',()=>{document.getElementById('dropdown-menu').classList.remove('active');navigateToPage('marketplace');});
  document.getElementById('logout-btn').addEventListener('click',logout);

  // Install
  document.getElementById('install-btn').addEventListener('click',async ()=>{
    if(deferredPrompt){ deferredPrompt.prompt(); const { outcome } = await deferredPrompt.userChoice; deferredPrompt=null; if(outcome==='dismissed') notify('Install cancelled. You can install later from browser menu.','info'); }
    else notify('App already installed or not available','info');
    hideInstallPrompt();
  });
  document.getElementById('dismiss-install').addEventListener('click',hideInstallPrompt);

  // Location change
  document.getElementById('user-location').addEventListener('click',()=>{
    const v = prompt('Enter your address:', document.getElementById('user-location').textContent.replace('📍 ',''));
    if(v){ updateLocationUI(v); loadServices(); }
  });

  // Demo login
  document.getElementById('demo-login-btn').addEventListener('click',()=>{
    currentUser={name:'Demo User',email:'demo@zippup.com',isProvider:false};
    isAuthenticated=true; isProvider=false;
    localStorage.setItem('zippup_user', JSON.stringify(currentUser));
    document.getElementById('auth-screen').style.display='none'; showMainApp();
  });

  // Login/Register
  document.getElementById('login-btn').addEventListener('click',handleLogin);
  document.getElementById('register-btn').addEventListener('click',handleRegister);

  // Search
  document.getElementById('search-input').addEventListener('input',e=>handleSearchInput(e.target.value));
  document.getElementById('search-input').addEventListener('keypress',e=>{ if(e.key==='Enter') handleSearchEnter(e.target.value); });

  // Emergency
  document.getElementById('emergency-btn').addEventListener('click',()=>{document.getElementById('emergency-modal').style.display='flex';});
  document.querySelectorAll('.emergency-service').forEach(s=>s.addEventListener('click',e=>handleEmergencyService(e.currentTarget.dataset.emergency)));

  // Quick actions
  document.querySelectorAll('.quick-action').forEach(a=>a.addEventListener('click',e=>handleQuickAction(e.currentTarget.dataset.action)));

  // Bottom nav
  document.querySelectorAll('.nav-item').forEach(i=>i.addEventListener('click',e=>navigateToPage(e.currentTarget.dataset.page)));

  // Backs
  ['providers','wallet','profile','services','bookings','chat','food-categories','food-items','grocery','transport-categories','digital-services','marketplace'].forEach(id=>{
    const el=document.getElementById(`${id}-back`); if(el) el.addEventListener('click',()=>navigateToPage('home'));
  });

  // Food/Grocery search
  if(document.getElementById('food-search-input')) document.getElementById('food-search-input').addEventListener('input',e=>filterFoodItems(e.target.value));
  if(document.getElementById('grocery-search-input')) document.getElementById('grocery-search-input').addEventListener('input',e=>filterGroceryStores(e.target.value));

  // Category clicks
  document.querySelectorAll('[data-category]').forEach(c=>c.addEventListener('click',e=>{
    const cat=e.currentTarget.dataset.category;
    if(cat==='fastfood') navigateToPage('food-items'), showFoodItems('burger');
    else if(cat==='grocery'){ navigateToPage('grocery'); loadGroceryStores(); }
  }));
  document.querySelectorAll('[data-foodtype]').forEach(c=>c.addEventListener('click',e=>showFoodItems(e.currentTarget.dataset.foodtype)));
  document.querySelectorAll('[data-transport]').forEach(c=>c.addEventListener('click',e=>showTransportCategory(e.currentTarget.dataset.transport)));
  document.querySelectorAll('[data-digital]').forEach(c=>c.addEventListener('click',e=>showDigitalService(e.currentTarget.dataset.digital)));
  document.querySelectorAll('[data-marketplace]').forEach(c=>c.addEventListener('click',e=>showMarketplaceCategory(e.currentTarget.dataset.marketplace)));

  // Wallet
  const addMoney=document.getElementById('add-money'); if(addMoney) addMoney.addEventListener('click',()=>showWalletAction('add'));
  const sendMoney=document.getElementById('send-money'); if(sendMoney) sendMoney.addEventListener('click',()=>showWalletAction('send'));
}

/* ====== Provider Registration ====== */
function handleProviderRegistration(){
  if(isProvider){ notify('You are already a registered provider!','info'); return; }
  if(confirm('Become a ZippUp Provider?\n\nStart earning by offering your services.\nProceed?')){
    notify('Processing provider registration...','info');
    setTimeout(()=>{ isProvider=true; currentUser.isProvider=true; localStorage.setItem('zippup_user',JSON.stringify(currentUser));
      document.getElementById('provider-registration-card').style.display='none';
      document.getElementById('provider-status').classList.remove('hidden');
      updateProviderStatus();
      notify('🎉 You are now a verified provider!','success');
    },1200);
  }
}

/* ====== Search ====== */
function handleSearchInput(q){
  if(!q.trim()){ document.getElementById('search-suggestions').classList.remove('active'); return; }
  const sugg = searchData.filter(i=>i.title.toLowerCase().includes(q.toLowerCase()) || i.category.toLowerCase().includes(q.toLowerCase()));
  showSearchSuggestions(sugg);
}
function handleSearchEnter(q){
  if(!q.trim()) return;
  document.getElementById('search-suggestions').classList.remove('active');
  const exact = searchData.find(i=>i.title.toLowerCase()===q.toLowerCase());
  if(exact) return exact.action();
  const partial = searchData.find(i=>i.title.toLowerCase().includes(q.toLowerCase()));
  if(partial) return partial.action();
  const svc = services.find(s=>s.name.toLowerCase().includes(q.toLowerCase()) || s.description.toLowerCase().includes(q.toLowerCase()));
  if(svc) return handleServiceClick(svc);
  notify(`🔍 No results for "${q}"`,'info');
}
function showSearchSuggestions(list){
  const c=document.getElementById('search-suggestions'); c.innerHTML='';
  if(list.length===0){ c.innerHTML='<div class=\"suggestion-item\"><div>🔍</div><div><div style=\"font-weight:700\">No suggestions found</div><div style=\"color:var(--muted);font-size:.9rem\">Try searching for services, food, or transport</div></div></div>'; }
  else{
    list.slice(0,8).forEach(s=>{
      const el=document.createElement('div'); el.className='suggestion-item';
      el.innerHTML=`<div>${s.icon}</div><div><div style="font-weight:700">${s.title}</div><div style="color:var(--muted);font-size:.9rem">${s.category}</div></div>`;
      el.addEventListener('click',()=>{ document.getElementById('search-input').value=s.title; s.action(); c.classList.remove('active'); });
      c.appendChild(el);
    });
  }
  c.classList.add('active');
}

/* ====== Navigation ====== */
function navigateToPage(page){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  const target=document.getElementById(`${page}-page`); if(target) target.classList.add('active');
  document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));
  const nav=document.querySelector(`[data-page="${page}"]`); if(nav) nav.classList.add('active');
  const header=document.querySelector('.header'); const panic=document.getElementById('emergency-btn');
  if(page==='home'){ header.style.display='block'; panic.style.display='block'; } else { header.style.display='none'; panic.style.display='none'; }
  currentPage=page;
  if(page==='services') loadAllServices();
  else if(page==='bookings') loadBookingsPage();
  else if(page==='wallet') updateCurrencyDisplay();
}

/* ====== Food ====== */
function showFoodItems(foodType){
  const titleMap={pizza:'Pizza Options',burger:'Burger Menu',meat:'Meat & Grill',fries:'Fries & Sides',chicken:'Chicken Dishes',drinks:'Drinks & Beverages'};
  document.getElementById('food-items-title').textContent = titleMap[foodType] || 'Food Items';
  const container=document.getElementById('food-items-grid'); const items=foodItems[foodType]||[];
  container.innerHTML=''; items.forEach(item=>{
    const card=document.createElement('div'); card.className='provider-card';
    card.innerHTML=`<div class=\"provider-header\"><div class=\"provider-avatar\">${item.icon}</div><div class=\"provider-info\"><h3>${item.name}</h3><div class=\"provider-rating\">⭐ ${item.rating}</div></div></div><div class=\"provider-description\">${item.restaurant}</div><div class=\"provider-price\" style=\"background:var(--success)\">${userCurrency}${item.price} • Add to Cart</div>`;
    card.addEventListener('click',()=>addToCart(item)); container.appendChild(card);
  });
  navigateToPage('food-items');
}
function addToCart(item){
  notify(`✅ Added ${item.name} (${userCurrency}${item.price})`,'success');
  bookings.unshift({id:Date.now(),service:'Food Order',providerName:item.restaurant,status:'confirmed',timestamp:new Date().toISOString(),price:userCurrency+item.price,type:'food'});
  saveBookings();
}
function filterFoodItems(q){ document.querySelectorAll('#food-items-grid .provider-card').forEach(c=>{ c.style.display=c.textContent.toLowerCase().includes(q.toLowerCase())?'block':'none'; }); }
function loadGroceryStores(){
  const c=document.getElementById('grocery-stores'); c.innerHTML='';
  groceryStores.forEach(s=>{
    const card=document.createElement('div'); card.className='provider-card';
    card.innerHTML=`<div class=\"provider-header\"><div class=\"provider-avatar\">${s.avatar}</div><div class=\"provider-info\"><h3>${s.name}</h3><div class=\"provider-rating\">⭐ ${s.rating}</div></div></div><div class=\"provider-details\"><div><div style=\"font-weight:800\">${s.items}</div><div style=\"color:var(--muted);font-size:.85rem\">Items</div></div><div><div style=\"font-weight:800\">${s.experience}</div><div style=\"color:var(--muted);font-size:.85rem\">Experience</div></div><div><div style=\"font-weight:800\">${s.delivery}</div><div style=\"color:var(--muted);font-size:.85rem\">Delivery</div></div></div><div class=\"provider-description\">${s.description}</div><div class=\"provider-price\">🛒 Shop Now</div>`;
    card.addEventListener('click',()=>openGroceryStore(s)); c.appendChild(card);
  });
}
function openGroceryStore(store){
  notify(`🛒 Opening ${store.name}...`,'success');
  bookings.unshift({id:Date.now(),service:'Grocery Shopping',providerName:store.name,status:'in_progress',timestamp:new Date().toISOString(),type:'grocery'});
  saveBookings();
}
function filterGroceryStores(q){ document.querySelectorAll('#grocery-stores .provider-card').forEach(c=>{ c.style.display=c.textContent.toLowerCase().includes(q.toLowerCase())?'block':'none'; }); }

/* ====== Transport & Others ====== */
function showTransportCategory(type){
  const providers=transportProviders[type]||[];
  document.getElementById('providers-title').textContent = type==='ride'?'Ride Services':'Moving Services';
  const c=document.getElementById('providers-list'); c.innerHTML='';
  providers.forEach(p=>{
    const card=document.createElement('div'); card.className='provider-card';
    card.innerHTML=`<div class=\"provider-header\"><div class=\"provider-avatar\">${p.avatar}</div><div class=\"provider-info\"><h3>${p.name}</h3><div class=\"provider-rating\">⭐ ${p.rating}</div></div></div><div class=\"provider-details\"><div><div class=\"provider-stat-value\">${p.trips||p.jobs}</div><div style=\"color:var(--muted);font-size:.85rem\">${p.trips?'Trips':'Jobs'}</div></div><div><div class=\"provider-stat-value\">${p.experience}</div><div style=\"color:var(--muted);font-size:.85rem\">Experience</div></div><div><div class=\"provider-stat-value\">${userCurrency}${p.price}</div><div style=\"color:var(--muted);font-size:.85rem\">Price Range</div></div></div><div class=\"provider-description\">${p.description}</div><div class=\"provider-price\">📅 Book Now (Instant & Scheduled)</div>`;
    card.addEventListener('click',()=>selectTransportProvider(p,type)); c.appendChild(card);
  });
  navigateToPage('providers');
}
function selectTransportProvider(provider,type){
  const instant = confirm('Choose booking type:\n\nOK = Book Instantly\nCancel = Schedule for Later');
  const timing = instant?'instant':'scheduled';
  notify(`✅ ${timing==='instant'?'Instant':'Scheduled'} booking with ${provider.name}`,'success');
  bookings.unshift({id:Date.now(),providerId:provider.id,providerName:provider.name,service:`${type==='ride'?'Ride':'Moving'} Service`,status:'confirmed',timestamp:new Date().toISOString(),price:userCurrency+provider.price.split('-')[0],type:'transport',timing});
  saveBookings();
}
function showOthersProviders(){
  document.getElementById('providers-title').textContent='Other Services';
  const c=document.getElementById('providers-list'); c.innerHTML='';
  othersProviders.forEach(p=>{
    const card=document.createElement('div'); card.className='provider-card';
    card.innerHTML=`<div class=\"provider-header\"><div class=\"provider-avatar\">${p.avatar}</div><div class=\"provider-info\"><h3>${p.name}</h3><div class=\"provider-rating\">⭐ ${p.rating}</div></div></div><div class=\"provider-details\"><div><div class=\"provider-stat-value\">${p.events||p.students||p.cases||p.shoots}</div><div style=\"color:var(--muted);font-size:.85rem\">${p.events?'Events':p.students?'Students':p.cases?'Cases':'Shoots'}</div></div><div><div class=\"provider-stat-value\">${p.experience}</div><div style=\"color:var(--muted);font-size:.85rem\">Experience</div></div><div><div class=\"provider-stat-value\">${p.price}</div><div style=\"color:var(--muted);font-size:.85rem\">Price Range</div></div></div><div class=\"provider-description\">${p.description}</div><div class=\"provider-price\">📞 Contact Provider</div>`;
    card.addEventListener('click',()=>selectOthersProvider(p)); c.appendChild(card);
  });
  navigateToPage('providers');
}
function selectOthersProvider(p){
  notify(`📞 Contacting ${p.name}...`,'success');
  bookings.unshift({id:Date.now(),providerId:p.id,providerName:p.name,service:'Other Services',status:'pending',timestamp:new Date().toISOString(),price:p.price,type:'others'});
  saveBookings();
}

/* ====== Digital & Marketplace ====== */
function showDigitalService(serviceType){
  const m={airtime:{title:'Buy Airtime',options:['$5','$10','$20','$50'],networks:['Verizon','AT&T','T-Mobile','Sprint']},data:{title:'Data Bundles',options:['1GB - $10','5GB - $25','10GB - $45','Unlimited - $65'],networks:['Verizon','AT&T','T-Mobile','Sprint']},bills:{title:'Pay Bills',options:['Electricity','Water','Internet','Cable TV'],networks:['ConEd','Verizon','Spectrum','DirectTV']},vouchers:{title:'Gift Vouchers',options:['$10','$25','$50','$100'],networks:['Amazon','iTunes','Google Play','Netflix']},gaming:{title:'Gaming Credits',options:['$5','$10','$25','$50'],networks:['PUBG','Fortnite','Mobile Legends','Free Fire']},streaming:{title:'Streaming',options:['1 Month','3 Months','6 Months','1 Year'],networks:['Netflix','Spotify','Disney+','YouTube Premium']}};
  const s=m[serviceType]; if(!s) return;
  const k=prompt(`${s.title}\n\n${s.options.map((o,i)=>`${i+1}. ${o}`).join('\n')}\n\nChoose (1-4):`); if(!k || k<1 || k>4) return;
  const option=s.options[k-1], net=s.networks[Math.min(k-1, s.networks.length-1)]||'Provider';
  notify(`✅ ${s.title}: ${option} (${net}) - Processing...`,'success');
  setTimeout(()=>{ notify(`🎉 ${s.title} completed successfully!`,'success'); bookings.unshift({id:Date.now(),service:s.title,providerName:net,status:'completed',timestamp:new Date().toISOString(),price:option.includes('$')?option.split(' ')[0]:'$'+(k*10),type:'digital'}); saveBookings(); },1200);
}
function showMarketplaceCategory(cat){
  const map={electronics:'Electronics - Phones, laptops, gadgets!',fashion:'Fashion - Clothing & accessories!',home:'Home & Garden - Furniture & decor!',sports:'Sports - Equipment & fitness!'};
  notify(`🛍️ ${map[cat]||'Category coming soon!'}`,'info');
}

/* ====== Wallet ====== */
function showWalletAction(a){
  if(a==='add'){
    const amount=prompt('Enter amount to add:','50'); if(amount && !isNaN(amount) && +amount>0){ notify(`💰 Adding ${userCurrency}${amount}...`,'info'); setTimeout(()=>notify(`✅ Added ${userCurrency}${amount}`,'success'),1000); }
  }else if(a==='send'){
    const to=prompt('Enter recipient:'); if(to){ const amount=prompt('Enter amount:','20'); if(amount && !isNaN(amount) && +amount>0){ notify(`📤 Sending ${userCurrency}${amount} to ${to}...`,'info'); setTimeout(()=>notify(`✅ Sent ${userCurrency}${amount} to ${to}`,'success'),1000); } }
  }
}

/* ====== Profile ====== */
function showProfileAction(a){
  const m={edit:['✏️','Update name, photo, phone'],payment:['💳','Manage cards and bank accounts'],notifications:['🔔','Push/SMS/Email preferences'],help:['❓','FAQ, chat, email, phone'],settings:['⚙️','Language, currency, privacy']};
  const x=m[a]; if(x) notify(`${x[0]} ${x[1]}`,'info');
}

/* ====== Auth Handlers ====== */
async function handleLogin(){
  const emailOrPhone=document.getElementById('login-email').value.trim();
  const password=document.getElementById('login-password').value;
  clearErrors();
  if(!validateLogin(emailOrPhone,password)) return;
  const btn=document.getElementById('login-btn'); btn.classList.add('loading'); btn.disabled=true;
  try{
    if(supabaseClient){
      let res;
      if(emailOrPhone.includes('@')) res = await supabaseClient.auth.signInWithPassword({ email: emailOrPhone, password });
      else res = await supabaseClient.auth.signInWithPassword({ phone: emailOrPhone, password });
      if(res.error){
        const u=mockUsers.find(u=>(u.email===emailOrPhone || u.phone===emailOrPhone) && u.password===password);
        if(!u){ showError('login-password', res.error.message || 'Invalid credentials'); return; }
        currentUser={name:u.name,email:u.email,phone:u.phone,isProvider:!!u.isProvider}; isAuthenticated=true; isProvider=!!u.isProvider;
      }else if(res.data?.user){
        const u=res.data.user;
        currentUser={name:u.user_metadata?.full_name || 'User', email:u.email || '', phone:u.user_metadata?.phone || '', isProvider:false};
        isAuthenticated=true; isProvider=false;
      }
    }else{
      const u=mockUsers.find(u=>(u.email===emailOrPhone || u.phone===emailOrPhone) && u.password===password);
      if(!u){ showError('login-password','Invalid credentials. Try demo@zippup.com / password123'); return; }
      currentUser={name:u.name,email:u.email,phone:u.phone,isProvider:!!u.isProvider}; isAuthenticated=true; isProvider=!!u.isProvider;
    }
    localStorage.setItem('zippup_user', JSON.stringify(currentUser));
    document.getElementById('auth-screen').style.display='none'; showMainApp();
  }catch{ showError('login-password','Login failed. Please try again.'); }
  finally{ btn.classList.remove('loading'); btn.disabled=false; }
}
async function handleRegister(){
  const name=document.getElementById('register-name').value.trim();
  const email=document.getElementById('register-email').value.trim();
  const phone=document.getElementById('register-phone').value.trim();
  const password=document.getElementById('register-password').value;
  clearErrors();
  if(!validateRegistration(name,email,phone,password)) return;
  const btn=document.getElementById('register-btn'); btn.classList.add('loading'); btn.disabled=true;
  try{
    if(supabaseClient){
      const { error } = await supabaseClient.auth.signUp({ email, password, options:{ data:{ full_name:name, phone } } });
      if(error){ showError('register-email', error.message || 'Registration failed.'); return; }
      currentUser={name,email,phone,isProvider:false}; isAuthenticated=true;
    }else{
      const exists=mockUsers.find(u=>u.email===email); if(exists){ showError('register-email','Email already registered.'); return; }
      mockUsers.push({name,email,phone,password,isProvider:false}); currentUser={name,email,phone,isProvider:false}; isAuthenticated=true;
    }
    isProvider=false; localStorage.setItem('zippup_user', JSON.stringify(currentUser));
    document.getElementById('auth-screen').style.display='none'; showMainApp();
    notify('🎉 Account created! Check your email to confirm.','success');
  }catch{ showError('register-email','Registration failed. Please try again.'); }
  finally{ btn.classList.remove('loading'); btn.disabled=false; }
}
function validateLogin(e,p){ let ok=true; if(!e){ showError('login-email','Email or phone is required'); ok=false; } if(!p){ showError('login-password','Password is required'); ok=false; } return ok; }
function validateRegistration(n,e,pn,pw){ let ok=true; if(!n||n.length<2){ showError('register-name','Name must be at least 2 characters'); ok=false; } if(!e||!e.includes('@')){ showError('register-email','Valid email is required'); ok=false; } if(!pn||pn.length<10){ showError('register-phone','Valid phone is required'); ok=false; } if(!pw||pw.length<6){ showError('register-password','Password must be at least 6'); ok=false; } return ok; }
function showError(id,msg){ const f=document.getElementById(id); const d=document.getElementById(id+'-error'); if(f) f.classList.add('error'); if(d){ d.textContent=msg; d.classList.remove('hidden'); } }
function clearErrors(){ document.querySelectorAll('.input').forEach(i=>i.classList.remove('error')); document.querySelectorAll('.error-message').forEach(e=>{e.classList.add('hidden'); e.textContent='';}); }
async function logout(){ try{ if(supabaseClient) await supabaseClient.auth.signOut(); }catch{} localStorage.removeItem('zippup_user'); currentUser=null; isAuthenticated=false; isProvider=false; bookings=[]; document.getElementById('app').style.display='none'; document.getElementById('dropdown-menu').classList.remove('active'); showAuthScreen(); notify('👋 Logged out','info'); }

/* ====== Services ====== */
function loadServices(){
  const c=document.getElementById('services'); c.innerHTML='';
  services.forEach(s=>{
    const card=document.createElement('div'); card.className='service-card';
    card.innerHTML=`<div class=\"service-icon\">${s.icon}</div><div class=\"service-name\">${s.name}</div><div class=\"service-description\">${s.description}</div><div class=\"service-examples\">${s.examples.join(', ')}</div><div class=\"service-price\">From ${userCurrency}${s.price}</div>`;
    card.addEventListener('click',()=>handleServiceClick(s)); c.appendChild(card);
  });
}
function loadAllServices(){
  const c=document.getElementById('all-services'); c.innerHTML='';
  services.forEach(s=>{
    const card=document.createElement('div'); card.className='service-card';
    card.innerHTML=`<div class=\"service-icon\">${s.icon}</div><div class=\"service-name\">${s.name}</div><div class=\"service-description\">${s.description}</div><div class=\"service-examples\">${s.examples.join(', ')}</div><div class=\"service-price\">From ${userCurrency}${s.price}</div>`;
    card.addEventListener('click',()=>handleServiceClick(s)); c.appendChild(card);
  });
}
function handleServiceClick(s){
  switch(s.type){
    case 'transport': navigateToPage('transport-categories'); break;
    case 'food': navigateToPage('food-categories'); break;
    case 'digital': navigateToPage('digital-services'); break;
    case 'emergency': document.getElementById('emergency-modal').style.display='flex'; break;
    case 'others': showOthersProviders(); break;
    default: showServiceProviders(s); break;
  }
}
function showServiceProviders(s){
  const providers=[
    { name:`${s.name} Expert`, rating:4.8, experience:'5 years', price:`${s.price}-${s.price+20}`, distance:'1.2km' },
    { name:`Pro ${s.name}`, rating:4.6, experience:'3 years', price:`${s.price+5}-${s.price+25}`, distance:'0.8km' }
  ];
  document.getElementById('providers-title').textContent = s.name+' Providers';
  const c=document.getElementById('providers-list'); c.innerHTML='';
  providers.forEach((p,i)=>{
    const card=document.createElement('div'); card.className='provider-card';
    card.innerHTML=`<div class=\"provider-header\"><div class=\"provider-avatar\">${s.icon}</div><div class=\"provider-info\"><h3>${p.name}</h3><div class=\"provider-rating\">⭐ ${p.rating}</div></div></div><div class=\"provider-details\"><div><div class=\"provider-stat-value\">${50+i*20}</div><div style=\"color:var(--muted);font-size:.85rem\">Jobs</div></div><div><div class=\"provider-stat-value\">${p.experience}</div><div style=\"color:var(--muted);font-size:.85rem\">Experience</div></div><div><div class=\"provider-stat-value\">${userCurrency}${p.price}</div><div style=\"color:var(--muted);font-size:.85rem\">Price Range</div></div></div><div class=\"provider-description\">Professional ${s.name.toLowerCase()} with excellent ratings</div><div class=\"provider-price\">📞 Book ${(s.hasInstant&&s.hasScheduled)?'(Instant & Scheduled)':(s.hasInstant?'(Instant)':'(Scheduled)')}</div>`;
    card.addEventListener('click',()=>selectServiceProvider(p,s)); c.appendChild(card);
  });
  navigateToPage('providers');
}
function selectServiceProvider(p,s){
  let type='instant';
  if(s.hasInstant && s.hasScheduled){ type = confirm('OK=Instant, Cancel=Schedule')?'instant':'scheduled'; }
  else if(s.hasScheduled){ type='scheduled'; }
  notify(`✅ ${type==='instant'?'Instant':'Scheduled'} booking with ${p.name}`,'success');
  bookings.unshift({id:Date.now(),providerName:p.name,service:s.name,status:'confirmed',timestamp:new Date().toISOString(),price:userCurrency+p.price.split('-')[0],type:s.type,timing:type});
  saveBookings();
}

/* ====== Bookings ====== */
function loadBookings(){ const s=localStorage.getItem('zippup_bookings'); if(s){ try{ bookings=JSON.parse(s) }catch{ bookings=[] } } }
function saveBookings(){ localStorage.setItem('zippup_bookings', JSON.stringify(bookings)); }
function loadBookingsPage(){
  const c=document.getElementById('bookings-list');
  if(bookings.length===0){ c.innerHTML=`<div style="text-align:center;padding:60px"><div style="font-size:3rem;margin-bottom:10px">📋</div><div style="font-weight:800">No bookings yet</div><div style="color:var(--muted);margin-top:6px">Start booking services to see them here</div></div>`; return; }
  c.innerHTML=''; bookings.forEach(b=>{
    const el=document.createElement('div'); el.className='provider-card';
    el.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px"><div style="font-weight:800">${b.service}</div><span style="background:${statusColor(b.status)};color:#fff;padding:4px 10px;border-radius:12px;font-size:.75rem;font-weight:800">${b.status.toUpperCase()}</span></div>${b.providerName?`<div style="color:var(--muted);margin-bottom:6px">Provider: ${b.providerName}</div>`:''}${b.timing?`<div style="color:#9CA3AF;margin-bottom:6px;font-size:.9rem">Booking: ${b.timing}</div>`:''}<div style="color:var(--muted);font-size:.9rem;margin-bottom:6px">${new Date(b.timestamp).toLocaleString()}</div>${b.price?`<div style="font-weight:800;color:var(--primary)">${b.price}</div>`:''}`;
    c.appendChild(el);
  });
}
function statusColor(s){ switch(s){ case 'completed':return 'var(--success)'; case 'confirmed':return 'var(--info)'; case 'in_progress':return 'var(--warning)'; case 'pending':return '#F59E0B'; case 'cancelled':return 'var(--danger)'; default:return '#CBD5E1'; } }

/* ====== Quick/Emergency ====== */
function handleQuickAction(a){ const map={ride:()=>navigateToPage('transport-categories'),food:()=>navigateToPage('food-categories'),digital:()=>navigateToPage('digital-services'),marketplace:()=>navigateToPage('marketplace')}; if(map[a]) map[a](); }
function handleEmergencyService(t){
  const msg={ambulance:'Ambulance dispatched! ETA 8–12m',fire:'Fire dept notified! ETA 5–8m',towing:'Towing requested! ETA 15–25m',roadside:'Roadside assistance on the way! ETA 10–15m'}[t]||'Emergency sent!';
  closeEmergencyModal(); notify(`🚨 ${msg}`,'error');
  bookings.unshift({id:Date.now(),service:`Emergency: ${t}`,type:'emergency',status:'active',timestamp:new Date().toISOString(),location:'Current location',timing:'instant'}); saveBookings();
}
function closeEmergencyModal(){ document.getElementById('emergency-modal').style.display='none'; }

/* ====== Utilities ====== */
function notify(message,type='info'){
  const n=document.createElement('div'); n.className=`notification ${type}`; n.textContent=message; document.body.appendChild(n);
  setTimeout(()=>n.classList.add('show'),50); setTimeout(()=>{ n.classList.remove('show'); setTimeout(()=>n.remove(),200); }, 4500);
}
  </script>
</body>
</html>
